<!DOCTYPE html>
<html>
<body>
<link rel="stylesheet" type="text/css" href="iso_style.css" />

<script type="text/javascript" src="d3.v3.min.js"></script>
<script type="text/javascript" src="jquery-1.8.2.js"></script>
<script type="text/javascript" src="util.js"></script>
<script type="text/javascript" src="draw_position.js"></script>
<script type="text/javascript" src="structures.js"></script>
<script type="text/javascript" src="input.js"></script>
<script type="text/javascript">
	var width = 500;
	var height = 500;
	
//	var edge = [{"from":"a","to":"b"}];
	
	$(document).ready(function(){
		height = $(window).height()-20;
		width = $(window).width()-20;
		//alert("in");
		var svg = d3.select("svg").attr("width", width).attr("height", height).append("g");
	
//		for(i=0; i<3; i++){
//			var v = new Vertex(i+"");
//			for(j=1; j<3; j++){
//				v.edges.push(new Edge(i+"", ((i+j) % 3)+"", 0));
//			}
//			graph.push(v);
//		}
		var v = new Vertex("a");
		v.edges.push(new Edge("a", "4", 3));
		graph.push(v);
		graph.push(new Vertex("4"));
		
		function redraw(){
			var graphIn = svg.selectAll("g .vertex").data(graph, function(d){return d.fqn();});
			console.log(graph);
			//ENTER
			graphIn.enter().append("g").classed("vertex", true)
			.attr("id",function(d){console.log("creating "+d.name);return "v"+d.name;})
			.each(function(d){
				d3.select(this).append("circle");
				d3.select(this).append("text");});
			
			//UPDATE
			graphIn.each(function(d,i){
				////Make vertices
				var ind = i;
				d3.select(this).select("circle")
				.attr("cx", function(d){
				return completeGraphPosition( 2*Math.PI*(ind/graph.length) )[0];})
				.attr("cy", function(d){
				return completeGraphPosition( 2*Math.PI*(ind/graph.length) )[1];})
				.attr("r", 10);
				////Make labels for those vertices. Pretty lame right now.
				d3.select(this).select("text")
				.attr("x", function(d){
				return completeGraphPosition( 2*Math.PI*(ind/graph.length) )[0]-4;})
				.attr("y", function(d){
				return completeGraphPosition( 2*Math.PI*(ind/graph.length) )[1]+5;})
				.text(function(d){return d.name;});
			});
			var allEdges = new Array();
			graphIn.each(function(d){
				allEdges = allEdges.concat(d.edges);
			});
			
			var edgeSet = svg.selectAll(".edge")
			.data(allEdges, function(d){return [d.from,d.to,d.weight].join("");});
				
			edgeSet.enter().append("line")
			.each(function(d){console.log(["enter:",d.from,d.to,d.weight].join(" "));});
				
			edgeSet.each(calculateEdge);
				
			edgeSet.exit()
			.each(function(d){console.log(["exit:",d.from,d.to,d.weight].join(" "));})
			.remove();

			//EXIT
			graphIn.exit().each(function(d){d3.selectAll(".e"+d.name).remove();}).remove();//Remove all edges leading to/from vertex before removing vertex
		}
		redraw();
		$('#submitInput').click(function(e){
			graph = parseGraphInput($('#input')[0].value);
			redraw();
		});
	});

	
</script>
<svg></svg>
<textarea id="input" rows="10" cols="90"></textarea><button id="submitInput" >Go!</button>
</body>
</html>